/*! tts_link - by cqol_77 2013-05-28 */
(function(t){var e={api:{re:"http://re.taotaosou.com/",browser:"http://browser.re.taotaosou.com/",upai:"http://ttsmedia.b0.upaiyun.com/",log:"http://log.taotaosou.com",tpl:"http://re.taotaosou.com/data/getTemplateContent.do?",ad:"http://show.kc.taotaosou.com/adShowJson.do?",mark:"http://re.taotaosou.com/data/getTagInfoByUrls.do?"},loadJS:function(t,e){var n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.onload=function(){e&&e(n)},n.onreadystatechange=function(){("loaded"===n.readyState||"complete"===n.readyState)&&e&&e(n)},n.src=t,document.body.appendChild(n)},loadCSS:function(t){var e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=t,e.appendChild(n)},load:function(t,e){t.match(/.js/)?this.loadJS(t,e):t.match(/.css/)&&this.loadCSS(t)},addEvent:function(e,n,o){return e.addEventListener?(e.addEventListener(n,o,!1),!0):e.attachEvent?(e["e"+n+o]=o,e[n+o]=function(){e["e"+n+o](t.event)},e.attachEvent("on"+n,e[n+o]),!0):!1},removeEvent:function(){return t.removeEventListener?function(t,e,n,o){t.removeEventListener(e,n,!!o)}:t.detachEvent?function(t,e,n){t.detachEvent("on"+e,n)}:function(){}},getByClassName:function(t,e){e=e||document;var n=[];if(e.querySelectorAll)n=e.querySelectorAll("."+t);else if(e.getElementsByClassName)n=e.getElementsByClassName(t);else for(var o=e.getElementsByTagName("*"),a=0,i=o.length;i>a;a++)o[a].className.match(t)&&n.push(o[a]);return n},setAttr:function(t,e){for(var n in e)t.setAttribute(n,e[n])},hasClass:function(t,e){try{return t.className.match(e)?!0:!1}catch(n){if("undefined"==typeof console)return!1;console.error("adClass: "+n)}},addClass:function(t,e){try{this.hasClass(t,e)||(""===t.className?t.className=e:t.className+=" "+e)}catch(n){if("undefined"==typeof console)return!1;console.error("adClass error: "+n)}},removeClass:function(t,e){try{t.className.length>e.length&&(e=" "+e),t.className=t.className.replace(e,"")}catch(n){if("undefined"==typeof console)return!1;console.error("adClass: "+n)}},setCSS:function(t,e){var n=function(e,n){t.style[e]=n};for(var o in e)e.hasOwnProperty(o)&&n(o,e[o])},offset:function(t){for(var e=0,n=0;t;)e+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;return{x:e,y:n}},width:function(t){var e=t.getBoundingClientRect();return e.width||e.right-e.left},height:function(t){var e=t.getBoundingClientRect();return e.height||e.bottom-e.top},index:function(t,e){for(var n=0,o=e.length;o>n;n++)if(e[n]===t)return n},ajax:function(t){var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=function(){for(var t=!1,n=0;e.length>n;n++){try{t=e[n]()}catch(o){continue}break}return t}();n&&(n.open(t.type,t.url,!0),n.setRequestHeader("User-Agent","XMLHTTP/1.0"),t.type&&n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&(200==n.status||304==n.status)&&t.success(n.responseText)},4!=n.readyState&&n.send(t.type))},isArray:function(t){return t.pop&&t.push&&t.reverse&&t.shift&&t.sort&&t.splice&&t.unshift&&t.concat&&t.join&&t.slice?!0:!1},hexToDec:function(t){return t=t.replace(/\\/g,"%"),unescape(t).replace(/%/g,"")},getDitchId:function(){var t,e,n,o,a=document.getElementsByTagName("script");for(t=0,e=a.length;e>t;t++)if(n=a[t],n.src&&n.src.match(/_tts_browser_center/))return o=a[t].src.match(RegExp("[?&]id=([^&]*)(&?)","i")),o?o[1]:"0000000000000000"},setCookie:function(t){var e=t.name+"="+encodeURIComponent(t.value);if("number"==typeof t.day){if(-[1])e+="; max-age="+24*60*60*t.day;else{var n=new Date;n.setTime((new Date).getTime()+1e3*3600*24*t.day),e+="; expires="+n.toGMTString()}t.path&&(e+="; path="+t.path),t.domain&&(e+="; domain="+t.domain)}document.cookie=e},getCookie:function(){var t,e,n,o,a,i={},s=document.cookie;if(""===s)return i;for(t=s.split("; "),e=0,n=t.length;n>e;e++){o=t[e],a=o.indexOf("=");var r;try{r=decodeURIComponent(o.substring(a+1))}catch(c){r=o.substring(a+1)}i[o.substring(0,a)]=r}return i},forEach:function(t,e){for(var n=0,o=t.length;o>n;n++)e(t[n],n)},getJSONP:function(t,n){var o="cb"+this.getJSONP.counter++,a="tts.getJSONP."+o,i=document.createElement("script");t+=t.match(/\?/)?"&":"?",t+="jsonp="+a,this.getJSONP[o]=function(t){try{n(t)}finally{delete e.getJSONP[o],i.parentNode.removeChild(i)}},i.charset="utf-8",i.src=t,document.body.appendChild(i)},tpl:function(t){var e=t.debug?"//199.155.122.206:9390/":this.api.re;t.url=t.url.match(/http/)?t.url:"http:"+t.url,this.getJSONP(e+"data/getTemplateContent.do?"+"path="+encodeURIComponent(t.url)+"&t="+(new Date).getTime(),function(e){"undefined"===e&&"undefined"!=typeof console&&console.error("文件获取失败："+t.url);var n=document.createElement("div");n.className="TTS-hide",n.innerHTML=e,document.body.appendChild(n),t.success&&t.success(n)})},getStyle:function(t,e){return"undefined"!=typeof getComputedStyle?getComputedStyle(t,null)[e]:t.currentStyle.key},imgload:function(t,e){var n=new Image;n.onload=function(){window.external.twGetRunPath&&window.external.twGetRunPath.match(/360se/)?setTimeout(e,100):e()},n.src=t.src},parent:function(t,e){var n,o=t.parentNode;for(n=function(){return"."===e.charAt(0)?"."+o.className!==e:o.nodeName!==e.toUpperCase()};o&&n();)o=o.parentNode;return o},attr:function(t,e){var n;return n=t?t.getAttribute(e):""},text:function(t){var e;return e=t?t.innerText:""}};t.tts||(e.getJSONP.counter=0,t.tts=e)})(window),function(t){var e={onload:!1,api:{re:"http://re.taotaosou.com",browser:"http://browser.re.taotaosou.com",tpl:"http://re.taotaosou.com/data/getTemplateContent.do?",ad:"http://show.kc.taotaosou.com/adShowJson.do?",linktrans:"http://browser.re.taotaosou.com/linktranslator",dclog:"http://dc.log.taotaosou.com/statistics.do?"},statistics:function(e,n){var o="J-ttklink-statistics";if(n=n||0,t.getByClassName(o).length>0)for(var a=t.getByClassName(o),i=0,s=a.length;s>i;i++)document.body.removeChild(a[i]);t.loadJS(t.api.log+"/browser_statistics.do?type="+e+"&v="+(new Date).getTime()+n,function(t){t.className=o})},getViewportHeight:function(){var t=-1,e=document.compatMode;return!e&&!this.isIE||this.isOpera||(t="CSS1Compat"===e?document.documentElement.clientHeight:document.body.clientHeight),t},getViewportWidth:function(){var t=-1,e=document.compatMode;return(e||this.isIE)&&(t="CSS1Compat"===e?document.documentElement.clientWidth:document.body.clientWidth),t},getOffsetTop:function(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e},trim:function(t){return t=t.trim?t.trim():t.replace(/ /g,"")},getChildImg:function(t){var e=this,n=t.innerHTML;if(n=e.trim(n),!t||!t.nodeType||1!==t.nodeType)return!1;for(var o=t.firstChild,a=!1;o;)1===o.nodeType&&"img"===o.tagName.toLowerCase()&&(a=!0),o=o.nextSibling;return 0===n.length&&(a=!0),a},init:function(n,o){var a,i,s,r=this,c=document.title,l=document.getElementsByTagName("a");a=RegExp("^([^-_]*)[-|_]?(.*)$","i").exec(c)[1],s=r.getCPS();var d,m,u,f,h=!1,p=-1,g=o;u=r.getViewportHeight(),f=r.getViewportWidth();var y=document.getElementById("J_ttklink_con"),v=document.getElementById("J_ttklink_point"),_=document.getElementById("J_ttklink_iframe"),k=document.getElementById("J_ttklink_close"),w=function(){y.style.visibility="visible",y.style.display="block",y.style.zIndex="999999",h=!0,r.statistics("ttkL_AdF_APV")},C=function(){y.style.visibility="hidden",y.style.display="none",y.style.zIndex="99998",h=!1},T=n;i=g?T:r.matchLink(l),i.length>0&&e.statistics("ttkL_Mark_PV"),t.forEach(i,function(e,n){e.index=n,r.createConImg(e),r.statistics("ttkL_Mark_Link_PV",n),t.addEvent(e,"click",function(){r.statistics("ttkL_Mark_Link_CK")}),t.addEvent(e,"mouseover",function(t){t=t||window.event;var o=t.target||t.srcElement,i=t.relatedTarget||t.fromElement;for(h=p===this.index?!0:!1,m&&clearTimeout(m);i&&"ttklink_con"!==i.className;)i=i.parentNode;for(;o&&"A"!==o.nodeName;)o=o.parentNode;var c,l,k,C,T=document.body.scrollTop||document.documentElement.scrollTop;g?k=g[n]:o&&"A"===o.nodeName&&(k=r.getItemId(e)),c=t.clientX,l=t.clientY,C=r.getOffsetTop(e);var E,N;N=r.getDataUrl(k,a,s),h&&p===this.index||(E=function(){w(),h&&p===this.index||(f/2>c?(y.style.left=c+25+"px",v.className="ttklink_point_left",245>C-T?(y.style.top=l+T-100+"px",v.style.top="85px"):245>u-C+T?(y.style.top=l+T-385+"px",v.style.top="380px"):(y.style.top=l+T-240+"px",v.style.top="225px")):(y.style.left=c-300+"px",v.className="ttklink_point_right",245>C-T?(y.style.top=l+T-100+"px",v.style.top="85px"):245>u-C+T?(y.style.top=l+T-385+"px",v.style.top="380px"):(y.style.top=l+T-230+"px",v.style.top="225px"))),h=!0},d&&clearTimeout(d),d=setTimeout(function(){E(),_&&(_.innerHTML='<iframe frameborder="0" allowTransparency="true" width="280" height="480" src="'+N+'"></iframe>')},500))}),t.addEvent(e,"mouseout",function(){h&&(p=this.index),d&&clearTimeout(d);var t=function(){C(),h=!1};m=setTimeout(function(){t()},500)})}),t.addEvent(y,"mouseover",function(){m&&clearTimeout(m);var t=function(){h||w()};d=setTimeout(function(){t()},500)}),t.addEvent(y,"mouseout",function(t){t=t||window.event,d&&clearTimeout(d);var e=function(){h&&C()};m=setTimeout(function(){e()},500)}),t.addEvent(k,"click",function(){C()})},wbinit:function(e){var n,o=this,a="",i=[],s=[],r=e;t.forEach(r,function(t,e){n=t.href,a+=","+encodeURIComponent(n),o.statistics("ttkL_Jpl_All_Num",e)}),t.loadJS(o.api.linktrans+"/transfer.do?"+"surl="+a.substring(1),function(){t.isArray(ttl_ids)&&(t.forEach(ttl_ids,function(t,e){t>0&&(i.push(r[e]),s.push(t),o.statistics("ttkL_Jpl_Tbl_Num",e))}),o.init(i,s))})},matchQQ:function(){var e,n,o=this,a=[],i="",s=[],r=[],c=document.getElementsByTagName("a");t.forEach(c,function(t){n=t.innerHTML,n.match(/url.cn/)&&(o.getChildImg(t)||a.push(t))}),t.forEach(a,function(t,n){e=t.innerHTML,i+=","+encodeURIComponent(e),o.statistics("ttkL_Jpl_All_Num",n)}),t.loadJS(o.api.linktrans+"/transfer.do?"+"surl="+i.substring(1),function(){t.isArray(ttl_ids)&&(t.forEach(ttl_ids,function(t,e){t>0&&(s.push(a[e]),r.push(t),o.statistics("ttkL_Jpl_Tbl_Num",e))}),o.init(s,r))})},matchNetEasy:function(){var e,n,o=this,a=[],i="",s=[],r=[],c=document.getElementsByTagName("a");t.forEach(c,function(t){n=t.innerHTML,n.match(/163.fm/)&&(o.getChildImg(t)||a.push(t))}),t.forEach(a,function(t,n){e=t.innerHTML,i+=","+encodeURIComponent(e),o.statistics("ttkL_Jpl_All_Num",n)}),t.loadJS(o.api.linktrans+"/transfer.do?"+"surl="+i.substring(1),function(){t.isArray(ttl_ids)&&(t.forEach(ttl_ids,function(t,e){t>0&&(s.push(a[e]),r.push(t),o.statistics("ttkL_Jpl_Tbl_Num",e))}),o.init(s,r))})},matchLink:function(e){var n=this,o=[];return t.forEach(e,function(t){var e=t.href,a=t.title;n.matchHost(e)?n.getItemId(t)&&(n.getChildImg(t)||o.push(t)):n.matchHost(a)&&n.getItemId(t)&&(n.getChildImg(t)||o.push(t))}),o},matchHost:function(t){return t?t.match(/item.taobao/)||t.match(/detail.tmall/)||t.match(/item.tmall/)?!0:!1:void 0},createConImg:function(e){var n=document.createElement("img");n.src="http://browser.re.taotaosou.com/images/ttlink/tts_icon.png",n.className="tts_icon",t.setCSS(n,{height:"12px",width:"14px",verticalAlign:"top"}),e.appendChild(n)},createTpl:function(){if(!this.onload){var t=document.createElement("div");t.id="ttklink_box";var e='<div id="J_ttklink_con" class="ttklink_con"><div class="ttklink_header"><a href="http://tk.taotaosou.com" class="ttklink_logo" target="_blank"><img src="http://browser.re.taotaosou.com/images/ttlink/ttk_logo.jpg" alt=""></a><a id="J_ttklink_close" href="javascript:void(0)" onclick="return false;" class="ttklink_close"><img src="http://browser.re.taotaosou.com/images/ttlink/ttk_close.jpg" alt=""></a></div><div id = "J_ttklink_iframe" class="ttklink_iframe"></div> <div id="J_ttklink_point" class=""></div></div>';t.innerHTML=e,document.body.appendChild(t)}},getItemId:function(t){var e,n,o=this,a=t.href,i=t.title;return a=unescape(a),i=unescape(i),n=function(t){t=t.split("&");for(var e=0,n=t.length;n>e;e++)t[e]&&t[e].match(/id=/)&&(t=t[e]);return t.slice(t.indexOf("id=")+3,t.length)},o.matchHost(a)?e=n(a):o.matchHost(i)&&(e=n(i)),parseInt(e,10)?e:void 0},getDataUrl:function(e,n,o){var a,i=this;if(e)return a=n?i.api.browser+"/getTtkLinkItems.do?itemId="+e+"&title="+encodeURIComponent(n)+"&cpsid="+o+"&ditch="+t.getDitchId():i.api.browser+"/getTtkLinkItems.do?itemId="+e+"&cpsid="+o+"&ditch="+t.getDitchId()},getCPS:function(){var t="",e=navigator.userAgent;return e.match(/CoolNovo/)?t="mm_30234426_2674428_9928618":e.match(/SE/)?t="mm_30234426_2674428_9928625":e.match(/QIHU 360EE/)?t="mm_30234426_2674428_9928614":e.match(/Chrome/)?t="mm_30234426_2674428_9928604":window.external.twGetRunPath&&window.external.twGetRunPath.match(/360se/)?t="mm_30234426_2674428_9928627":e.match(/MSIE/)&&(t="mm_30234426_2674428_9928630"),t}},n=document.location.host;if(n.match(/taobao|tmall|etao|meilishuo|taotaosou|alipay|zhifubao|alimama|alibaba/))if(n.match(/love.taobao/)){t.loadCSS(t.api.browser+"css/ttklink.css?v="+window.TTSVersion),e.createTpl(),e.init();var o,a,i=!1;document.getElementById("J_Lazyfall")&&(o=t.getByClassName("lazyfall"),a=o.length),t.addEvent(window,"scroll",function(){var n,o;document.getElementById("J_Lazyfall")&&(n=t.getByClassName("lazyfall"),o=n.length),a!==o&&i===!1&&(a=o,i=!0),i&&(e.init(),i=!1)})}else{if(!document.location.href.match(/www.meilishuo.com\/share/))return;t.loadCSS(t.api.browser+"css/ttklink.css?v="+window.TTSVersion),e.createTpl();var s=t.getByClassName("goods_title")[0],r=s.getElementsByTagName("a")[0],c=t.getByClassName("tobuy")[0],l=c.getElementsByTagName("a")[0],d=[r,l];e.wbinit(d)}else if(t.loadCSS(t.api.browser+"css/ttklink.css?v=1369712218322"),e.createTpl(),t.getCookie().TTKlinkFirst&&"1"===t.getCookie().TTKlinkFirst||(t.setCookie({name:"TTKlinkFirst",value:"1",day:365,path:"/",domain:n}),e.statistics("ttkL_Mark_UV")),n.match(/weibo/)){e.init();var m,u,f=!1;t.getByClassName("WB_feed_type")&&(m=t.getByClassName("WB_feed_type"),u=m.length),t.addEvent(window,"scroll",function(){var n,o;t.getByClassName("WB_feed_type")&&(n=t.getByClassName("WB_feed_type"),o=n.length),u!==o&&f===!1&&(u=o,f=!0),f&&(e.init(),f=!1)})}else if(n.match(/t.163/)){if(e.matchNetEasy(),t.getByClassName("mainBox-page")[0]){var h=t.getByClassName("mainBox-page")[0];t.addEvent(h,"click",function(){e.matchNetEasy()})}}else if(n.match(/t.qq/)){e.matchQQ();var p,g=!1;document.getElementById("talkList")&&(g=document.getElementById("talkList"),p=g.getElementsByTagName("li").length),t.addEvent(window,"scroll",function(){var t,n;document.getElementById("talkList")&&(t=document.getElementById("talkList"),n=t.getElementsByTagName("li").length),p!==n&&g===!1&&(p=n,g=!0),g&&(e.matchQQ(),g=!1)})}else if(n.match(/t.sohu/)){e.init();var y,v,_=!1;t.getByClassName("twi")&&(y=t.getByClassName("twi"),v=y.length),t.addEvent(window,"scroll",function(){var n,o;t.getByClassName("twi")&&(n=t.getByClassName("twi"),o=n.length),v!==o&&_===!1&&(v=o,_=!0),_&&(e.init(),_=!1)})}else e.init()}(window.tts);